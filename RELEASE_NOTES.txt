# Release Notes - Dial-A-Charmer

## v0.7.1-beta (2026-01-18) - "The Voice Feedback Update"
- **Enhanced Voice Navigation**:
    - **Base Speaker confirmation** when canceling timers or deleting manual alarms.
    - Added dedicated voice prompts for "Timer Cancelled" and "Alarm Deleted".
- **Hardware Controls**:
    - **Timer Cancel**: Lifting the handset now instantly cancels any running timer (with voice confirmation).
    - **Manual Alarm Delete**: Holding the extra button for ~3 seconds deletes the single-shot manual alarm.
- **Dial Codes**:
    - **Dial 90**: Explicit code to toggle ALL alarms.
    - **Dial 91**: Explicit code to toggle "Skip Next Alarm".

## v0.7.0-beta (2026-01-18) - "The Robustness Update"
- **Audio Multithreading**: Moved audio decoding to dedicated Core 0 task. Prevents stuttering during Web UI usage or heavy WiFi traffic.
- **Fail-Safe Features**:
    - **NVS Persistence**: Alarms now survive device reboots.
    - **RTC Support**: Added DS3231 support for timekeeping during internet outages.
    - **Fallback Tone**: Synthesized alarm tone generated if SD card files are missing.
- **Detailed Announcements**: Extended `speakTime()` to announce Weekday, Date, Month, Year, and DST status.
- **Improved Scripts**: Generator script now creates localized calendar audio assets.

## v0.6.0-beta (2026-01-18) - "The Streamlined Specialist"
- **Hardware Cleanup (GPS Removal)**:
    - Removed all dependencies on GNSS/GPS hardware (u-blox M10).
    - Timekeeping now relies exclusively on **NTP (Network Time Protocol)** via Wi-Fi.
    - Removed `TinyGPS++` library and associated UART handling code to reduce firmware size and complexity.
    - Updated `config.h` and pin definitions to reflect the hardware changes.
- **Web Interface 2.0 (SPA)**:
    - **Single Page Application**: The Web Manager now serves a static `index.html` from the device's SPIFFS filesystem instead of generating HTML strings in C++.
    - **Performance**: Faster load times and cleaner code separation between frontend (HTML/JS) and backend (API).
    - **Optimization**: Added `generate_mockups.py` and file serving logic to support the new architecture.
- **System Stability**:
    - **Watchdog Timer**: Implemented ESP32 Task Watchdog (WDT) with a 20-second timeout to automatically reset the device in case of system freeze.
    - **Audio Tools**: Updated `split_audio.py` with High-Pass Filtering and intelligent noise thresholding (-25dB) for cleaner audio segmenting.
- **Bug Fixes**:
    - Fixed `esp_task_wdt_init` compilation error by updating to the correct `esp_task_wdt_config_t` structure.
    - Fixed Web UI dropdowns showing file extensions.

## v0.5.0-beta (2026-01-16) - "The Intelligent Timekeeper"
- **Dual Alarm System**: 
    - **Single Alarm**: Priority alarm set via Rotary Dial (one-time use).
    - **Repeating Alarm**: Weekday-aware alarm schedule set via Web Interface.
    - **Skip Next Logic**: Dial `9 1` to skip the next scheduled recurring alarm without disabling the schedule entirely.
- **Enhanced Web Interface**:
    - **Split Design**: Separated into "Basic" (Home) and "Advanced" views to declutter usage.
    - **Previews**: Added ability to listen to Ringtones and Dial Tones directly in the browser.
    - **OTA Update**: Firmware can now be updated directly via the Advanced Settings page.
    - **Snooze Config**: Snooze duration is now user-configurable (0-20 mins).
- **AI & Directory**:
    - **Gemini AI Integration**: Phonebook entries can now trigger dynamic AI responses (e.g. "Tell me a joke").
    - **Phonebook API**: Full management of contacts/functions via JSON API.

## v0.4.0-beta (2026-01-16) - "The Conversationalist"
- **Audio Intelligence**:
    - **Half-Duplex AEC**: Implemented automatic microphone muting during audio playback to prevent echo and self-triggering when using Gemini AI.
    - **Interruption Logic**: Users can now stop playback/TTS instantly by pressing the Extra Button or placing the receiver on the hook.
- **Microphone Control**:
    - Added driver support for ES8311 ADC Volume/Mute control.
    - Automatic mute/unmute management in main loop.

## v0.3.0-alpha (2026-01-16)
- **Core System Architecture**:
    - **Hardware Conflict Resolution**: Migrated to `Adafruit_NeoPixel` to resolve FastLED/I2S timing conflicts. 
    - **Partitioning**: Upgraded to `huge_app.csv` to support larger OTA binaries.
    - **Pin Mapping**: Optimized pinout for Lolin D32 Pro (I2S DOUT moved to GPIO 27, Dial Mode Pin added on GPIO 36).
    - **Project Renaming**: Officially renamed to "Dial-A-Charmer".

- **Audio & Content**:
    - **Persona Playlists**: Implemented "Style" dialing (1=Trump, 2=Badran, 3=Yoda, 4=Neutral).
    - **Smart Shuffle**: Non-repeating playback logic for categories.
    - **Local Priority**: System prefers offline MP3s over TTS to ensure responsiveness.
    - **Tools**: Added `split_audio.py` for automated content preparation.

- **User Interaction**:
    - **Multi-Language**: Full DE/EN switching for prompts and TTS.
    - **Alarm Clock**: Hold-Button + 4-digit input (0730) to set daily alarms.
    - **Volume Control**: Independent sliders for Handset (Voice) and Ringer (Alarm) in WebUI.
    - **Night Mode**: Schedule-based LED dimming.

- **Web & Deployment**:
    - **Web Installer**: Browser-based flashing (ESP Web Tools).
    - **OTA**: Fully automated GitHub Actions workflow for builds.

## v0.1.0-alpha (Initial Release)
- **Core Functionality**:
  - Atomic Clock synchronization via GNSS (M10 module).
  - Rotary Dial input processing (Pulse counting with debounce).
  - Hook Switch and Extra Action Button support.
  - Audio playback via I2S (MAX98357A/PCM5102) from SD Card.
- **Features**:
  - **Timer/Alarm**: Set countdowns using the rotary dial when the receiver is on the hook.
  - **Compliment Dispenser**: Dial numbers (1-9) when the receiver is off the hook to hear compliments.
  - **Time Announcement**: Dial 0 when receiver is off the hook to hear the current time.
  - **Web Interface**: Captive Portal (Access Point "DialACharmer") for configuring Wi-Fi credentials and Timezone offset.
  - **Status LED**: WS2812 indication for boot, Wi-Fi status, and GNSS lock.
- **Configuration**:
  - Centralized `include/config.h` for all hardware pins and system constants.
  - Persistent settings (Wi-Fi, Timezone) saved to Flash memory.
  - Standalone operation (No external servers/Home Assistant required).
